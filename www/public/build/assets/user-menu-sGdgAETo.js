document.addEventListener("DOMContentLoaded",()=>{const n=document.getElementById("userMenu"),o=document.getElementById("userTrigger"),i=document.getElementById("userDropdown");if(!n||!o||!i)return;const s=()=>i.querySelectorAll("a.menu-item, button.menu-item");function d(){n.dataset.open="true",o.setAttribute("aria-expanded","true");const e=s();e.length&&e[0].focus()}function r(){delete n.dataset.open,o.setAttribute("aria-expanded","false")}function u(){return n.dataset.open==="true"}function a(){u()?r():d()}o.addEventListener("click",e=>{e.stopPropagation(),a()}),document.addEventListener("click",e=>{u()&&(n.contains(e.target)||r())}),document.addEventListener("keydown",e=>{if(!u())return;if(e.key==="Escape"){r(),o.focus();return}const t=Array.from(s());if(!t.length)return;const c=t.indexOf(document.activeElement);e.key==="ArrowDown"?(e.preventDefault(),t[(c+1+t.length)%t.length].focus()):e.key==="ArrowUp"?(e.preventDefault(),t[(c-1+t.length)%t.length].focus()):e.key==="Tab"&&(e.shiftKey&&document.activeElement===t[0]?(e.preventDefault(),t[t.length-1].focus()):!e.shiftKey&&document.activeElement===t[t.length-1]&&(e.preventDefault(),t[0].focus()))})});
